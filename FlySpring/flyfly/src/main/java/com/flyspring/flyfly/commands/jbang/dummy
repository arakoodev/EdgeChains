

private void runJbang(File jarFile, String javaFile, String classPathJar) {
    try {
      // Step One: Execute the initial command to get the classpath
      ProcessBuilder pb = new ProcessBuilder(
          "java",
          "-cp",
          jarFile.getAbsolutePath(),
          "dev.jbang.Main",
          "--cp",
          classPathJar,
          javaFile);
      pb.redirectErrorStream(true);
      Process process = pb.start();
      BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
      String classPath = extractClassPathFromOutput(bufferedReader);

      // The mainClass accepts any class name provided from the javaFile
      String mainClass = extractMainClassFromOutput(bufferedReader, javaFile);
      System.out.println("Extracted Classpath: " + classPath);
      System.out.println("Main Class: " + mainClass);

      process.waitFor();

      // Step Two: Execute the final command with the extracted classpath
      if (classPath != null && !classPath.isEmpty() && mainClass != null && !mainClass.isEmpty()) {
        runJavaWithClassPath(classPath, mainClass);
      } else {
        System.out.println("Could not extract classpath or main class from the output.");
      }
    } catch (IOException | InterruptedException e) {
      e.printStackTrace();
    }
  }